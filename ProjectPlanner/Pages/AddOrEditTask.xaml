<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ProjectPlanner.Pages.AddOrEditTask"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:ProjectPlanner.Pages"
    xmlns:model="clr-namespace:ProjectPlanner.Model;assembly=ProjectPlanner.Model"
    Title="TASK"
    x:DataType="local:AddOrEditTask"
    BackgroundColor="{StaticResource BackgroundDark}">

    <Grid RowDefinitions="*, Auto">
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="24" Spacing="24">

                <Label
                    Margin="0,0,0,-10"
                    FontFamily="TechFont"
                    FontSize="12"
                    Text="// TASK CONFIGURATION"
                    TextColor="{StaticResource TextSecondary}" />

                <VerticalStackLayout Spacing="8">
                    <Label
                        FontAttributes="Bold"
                        FontFamily="HeaderFont"
                        FontSize="14"
                        Text="PARENT PROJECT"
                        TextColor="{StaticResource NeonAccent}" />

                    <Border
                        BackgroundColor="{StaticResource SurfaceDark}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="1">
                        <Label
                            x:Name="lbl_project_name"
                            Margin="12"
                            FontFamily="TechFont"
                            FontSize="16"
                            TextColor="{StaticResource TextSecondary}" />
                    </Border>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label
                        FontAttributes="Bold"
                        FontFamily="HeaderFont"
                        FontSize="14"
                        Text="TASK NAME"
                        TextColor="{StaticResource NeonAccent}" />

                    <Border
                        BackgroundColor="{StaticResource SurfaceDark}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="1">
                        <Entry
                            x:Name="entry_task_name"
                            Margin="12"
                            FontFamily="TechFont"
                            FontSize="16"
                            Placeholder="ENTER NAME..."
                            PlaceholderColor="{StaticResource TextSecondary}"
                            TextColor="{StaticResource TextPrimary}" />
                    </Border>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label
                        FontAttributes="Bold"
                        FontFamily="HeaderFont"
                        FontSize="14"
                        Text="DETAILS"
                        TextColor="{StaticResource NeonAccent}" />

                    <Border
                        BackgroundColor="{StaticResource SurfaceDark}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="1">
                        <Editor
                            x:Name="entry_task_description"
                            Margin="12"
                            AutoSize="TextChanges"
                            FontFamily="TechFont"
                            FontSize="14"
                            Placeholder="MORE DATA..."
                            PlaceholderColor="{StaticResource TextSecondary}"
                            TextColor="{StaticResource TextPrimary}"
                            VerticalOptions="Start" />
                    </Border>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label
                        FontAttributes="Bold"
                        FontFamily="HeaderFont"
                        FontSize="14"
                        Text="PRIORITY"
                        TextColor="{StaticResource NeonAccent}" />

                    <Border
                        BackgroundColor="{StaticResource SurfaceDark}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="1">
                        <Picker
                            x:Name="picker_priority"
                            Margin="12"
                            FontFamily="TechFont"
                            FontSize="16"
                            TextColor="{StaticResource TextPrimary}">
                            <Picker.Items>
                                <x:String>0 - NONE</x:String>
                                <x:String>1 - LOW</x:String>
                                <x:String>2 - MEDIUM</x:String>
                                <x:String>3 - HIGH</x:String>
                                <x:String>4 - URGENT</x:String>
                                <x:String>5 - CRITICAL</x:String>
                            </Picker.Items>
                        </Picker>
                    </Border>
                </VerticalStackLayout>

                <VerticalStackLayout Spacing="8">
                    <Label
                        FontAttributes="Bold"
                        FontFamily="HeaderFont"
                        FontSize="14"
                        Text="TAGS"
                        TextColor="{StaticResource NeonAccent}" />

                    <Border
                        BackgroundColor="{StaticResource SurfaceDark}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeShape="RoundRectangle 4"
                        StrokeThickness="1">
                        <Entry
                            x:Name="entry_tags"
                            Margin="12"
                            FontFamily="TechFont"
                            FontSize="14"
                            Placeholder="TAGS (COMMA SEPARATED)..."
                            PlaceholderColor="{StaticResource TextSecondary}"
                            TextColor="{StaticResource TextPrimary}" />
                    </Border>
                </VerticalStackLayout>

                <Label
                    FontFamily="TechFont"
                    FontSize="12"
                    Text="// TASK RESOURCES"
                    TextColor="{StaticResource TextSecondary}" />

                <VerticalStackLayout Spacing="20">
                    <!--  ATTACHMENTS SECTION  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontFamily="HeaderFont"
                            FontSize="14"
                            Text="ATTACHMENTS"
                            TextColor="{StaticResource NeonAccent}" />

                        <Border
                            BackgroundColor="{StaticResource SurfaceDark}"
                            Stroke="{StaticResource BorderColor}"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="1">
                            <VerticalStackLayout Padding="12" Spacing="8">
                                <Label
                                    x:Name="lbl_no_attachments"
                                    FontFamily="TechFont"
                                    FontSize="12"
                                    HorizontalOptions="Center"
                                    Text="NO ATTACHMENTS ADDED."
                                    TextColor="{StaticResource TextSecondary}" />
                                <VerticalStackLayout
                                    x:Name="attachments_list"
                                    BindableLayout.ItemsSource="{Binding Attachments}"
                                    Spacing="8">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate x:DataType="model:TaskAttachment">
                                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                                <VerticalStackLayout Spacing="2">
                                                    <Label
                                                        FontFamily="TechFont"
                                                        FontSize="15"
                                                        Text="{Binding FileName}"
                                                        TextColor="{StaticResource NeonAccent}"
                                                        TextDecorations="Underline">
                                                        <Label.GestureRecognizers>
                                                            <TapGestureRecognizer Tapped="OnOpenAttachmentClicked" />
                                                        </Label.GestureRecognizers>
                                                    </Label>
                                                    <Label
                                                        FontFamily="TechFont"
                                                        FontSize="12"
                                                        Text="{Binding FilePath}"
                                                        TextColor="{StaticResource TextSecondary}" />
                                                </VerticalStackLayout>
                                                <Button
                                                    Grid.Column="1"
                                                    BackgroundColor="Transparent"
                                                    BorderColor="{StaticResource Magenta}"
                                                    BorderWidth="1"
                                                    Clicked="OnRemoveAttachmentClicked"
                                                    CommandParameter="{Binding .}"
                                                    FontFamily="HeaderFont"
                                                    FontSize="12"
                                                    HeightRequest="32"
                                                    Text="REMOVE"
                                                    TextColor="{StaticResource Magenta}" />
                                            </Grid>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>

                        <Button
                            BackgroundColor="Transparent"
                            BorderColor="{StaticResource NeonAccent}"
                            BorderWidth="1"
                            Clicked="OnAddAttachmentClicked"
                            CornerRadius="6"
                            FontFamily="HeaderFont"
                            FontSize="12"
                            HeightRequest="42"
                            Text="+ ADD ATTACHMENT"
                            TextColor="{StaticResource NeonAccent}" />
                    </VerticalStackLayout>

                    <!--  LINKS SECTION  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontFamily="HeaderFont"
                            FontSize="14"
                            Text="LINKS"
                            TextColor="{StaticResource NeonAccent}" />

                        <Border
                            BackgroundColor="{StaticResource SurfaceDark}"
                            Stroke="{StaticResource BorderColor}"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="1">
                            <VerticalStackLayout Padding="12" Spacing="8">
                                <Label
                                    x:Name="lbl_no_links"
                                    FontFamily="TechFont"
                                    FontSize="12"
                                    HorizontalOptions="Center"
                                    Text="NO LINKS ADDED."
                                    TextColor="{StaticResource TextSecondary}" />
                                <VerticalStackLayout
                                    x:Name="links_list"
                                    BindableLayout.ItemsSource="{Binding Links}"
                                    Spacing="8">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate x:DataType="model:TaskLink">
                                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                                <VerticalStackLayout Spacing="2">
                                                    <Label
                                                        FontFamily="TechFont"
                                                        FontSize="15"
                                                        Text="{Binding Title}"
                                                        TextColor="{StaticResource NeonAccent}"
                                                        TextDecorations="Underline">
                                                        <Label.GestureRecognizers>
                                                            <TapGestureRecognizer Tapped="OnOpenLinkClicked" />
                                                        </Label.GestureRecognizers>
                                                    </Label>
                                                    <Label
                                                        FontFamily="TechFont"
                                                        FontSize="12"
                                                        Text="{Binding Url}"
                                                        TextColor="{StaticResource TextSecondary}" />
                                                </VerticalStackLayout>
                                                <Button
                                                    Grid.Column="1"
                                                    BackgroundColor="Transparent"
                                                    BorderColor="{StaticResource Magenta}"
                                                    BorderWidth="1"
                                                    Clicked="OnRemoveLinkClicked"
                                                    CommandParameter="{Binding .}"
                                                    FontFamily="HeaderFont"
                                                    FontSize="12"
                                                    HeightRequest="32"
                                                    Text="REMOVE"
                                                    TextColor="{StaticResource Magenta}" />
                                            </Grid>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>

                        <Button
                            BackgroundColor="Transparent"
                            BorderColor="{StaticResource NeonAccent}"
                            BorderWidth="1"
                            Clicked="OnAddLinkClicked"
                            CornerRadius="6"
                            FontFamily="HeaderFont"
                            FontSize="12"
                            HeightRequest="42"
                            Text="+ ADD LINK"
                            TextColor="{StaticResource NeonAccent}" />
                    </VerticalStackLayout>

                    <!--  NOTES SECTION  -->
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontFamily="HeaderFont"
                            FontSize="14"
                            Text="NOTES"
                            TextColor="{StaticResource NeonAccent}" />

                        <Border
                            BackgroundColor="{StaticResource SurfaceDark}"
                            Stroke="{StaticResource BorderColor}"
                            StrokeShape="RoundRectangle 4"
                            StrokeThickness="1">
                            <VerticalStackLayout Padding="12" Spacing="8">
                                <Label
                                    x:Name="lbl_no_notes"
                                    FontFamily="TechFont"
                                    FontSize="12"
                                    HorizontalOptions="Center"
                                    Text="NO NOTES RECORDED."
                                    TextColor="{StaticResource TextSecondary}" />
                                <VerticalStackLayout
                                    x:Name="notes_list"
                                    BindableLayout.ItemsSource="{Binding Notes}"
                                    Spacing="8">
                                    <BindableLayout.ItemTemplate>
                                        <DataTemplate x:DataType="model:TaskNote">
                                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                                <VerticalStackLayout Spacing="2">
                                                    <Label
                                                        FontFamily="TechFont"
                                                        FontSize="15"
                                                        LineBreakMode="WordWrap"
                                                        Text="{Binding Content}"
                                                        TextColor="{StaticResource TextPrimary}" />
                                                    <Label
                                                        FontFamily="TechFont"
                                                        FontSize="12"
                                                        Text="{Binding CreatedAt, StringFormat='CREATED {0:dd MMM yyyy HH:mm}'}"
                                                        TextColor="{StaticResource TextSecondary}" />
                                                </VerticalStackLayout>
                                                <Button
                                                    Grid.Column="1"
                                                    BackgroundColor="Transparent"
                                                    BorderColor="{StaticResource Magenta}"
                                                    BorderWidth="1"
                                                    Clicked="OnRemoveNoteClicked"
                                                    CommandParameter="{Binding .}"
                                                    FontFamily="HeaderFont"
                                                    FontSize="12"
                                                    HeightRequest="32"
                                                    Text="REMOVE"
                                                    TextColor="{StaticResource Magenta}" />
                                            </Grid>
                                        </DataTemplate>
                                    </BindableLayout.ItemTemplate>
                                </VerticalStackLayout>
                            </VerticalStackLayout>
                        </Border>

                        <Button
                            BackgroundColor="Transparent"
                            BorderColor="{StaticResource NeonAccent}"
                            BorderWidth="1"
                            Clicked="OnAddNoteClicked"
                            CornerRadius="6"
                            FontFamily="HeaderFont"
                            FontSize="12"
                            HeightRequest="42"
                            Text="+ ADD NOTE"
                            TextColor="{StaticResource NeonAccent}" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <Grid
            Grid.Row="1"
            Margin="24,10,24,24"
            ColumnDefinitions="*,*"
            ColumnSpacing="16">
            <Button
                Grid.Column="0"
                BackgroundColor="Transparent"
                BorderColor="{StaticResource NeonAccent}"
                BorderWidth="1"
                Clicked="OnCancelClicked"
                FontFamily="HeaderFont"
                Text="CANCEL"
                TextColor="{StaticResource NeonAccent}" />

            <Button
                Grid.Column="1"
                BackgroundColor="{StaticResource NeonAccent}"
                Clicked="OnSaveClicked"
                FontAttributes="Bold"
                FontFamily="HeaderFont"
                Text="SAVE"
                TextColor="{StaticResource Black}" />
        </Grid>
    </Grid>
</ContentPage>