<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:ProjectPlanner.helpers"
             x:Class="ProjectPlanner.Pages.MainPage">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:TextTruncateConverter x:Key="TruncateConv" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid RowDefinitions="*,Auto">

        <CollectionView x:Name="ProjectsList"
                        Grid.Row="0"
                        ItemsSource="{Binding Projects}"
                        SelectionChanged="ProjectsList_SelectionChanged"
                        SelectionMode="Single">

            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                    <Image HeightRequest="150"
                           Opacity="0.6"
                           Source="empty_state.png" />
                    <Label Margin="0,10,0,5"
                           FontSize="18"
                           HorizontalOptions="Center"
                           Text="Brak projektów"
                           TextColor="{StaticResource TextSecondary}" />
                    <Button Clicked="AddProjectBtn_Clicked"
                            Text="➕ Dodaj projekt"
                            WidthRequest="200" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Margin="5"
                          Padding="10"
                          BackgroundColor="#202020"
                          ColumnDefinitions="Auto,*,Auto">

                        <VerticalStackLayout Grid.Column="1">
                            <Label FontAttributes="Bold"
                                   FontFamily="HeaderFont"
                                   FontSize="20"
                                   Text="{Binding Name}"
                                   TextColor="{StaticResource TextPrimary}" />

                            <Label FontFamily="TechFont"
                                   FontSize="14"
                                   Text="{Binding Description, Converter={StaticResource TruncateConv}, ConverterParameter='15'}"
                                   TextColor="{StaticResource TextSecondary}" />

                            <ProgressBar Margin="0,8,0,0"
                                         BackgroundColor="#2A2A2A"
                                         HeightRequest="8"
                                         Progress="{Binding Progress}"
                                         ProgressColor="{StaticResource AccentColor}" />
                        </VerticalStackLayout>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button x:Name="AddProjectBtn"
                Grid.Row="1"
                Margin="0,10,10,10"
                BackgroundColor="{StaticResource AccentColor}"
                Clicked="AddProjectBtn_Clicked"
                CornerRadius="30"
                FontSize="26"
                HeightRequest="60"
                HorizontalOptions="End"
                Text="＋"
                TextColor="Black"
                VerticalOptions="End"
                WidthRequest="60" />
    </Grid>
</ContentPage>