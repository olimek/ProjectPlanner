<ContentPage
    x:Class="ProjectPlanner.Pages.MainPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:ProjectPlanner.helpers"
    Title="MAIN PANEL"
    BackgroundColor="{StaticResource BackgroundDark}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:TextTruncateConverter x:Key="TruncateConv" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">

        <VerticalStackLayout Grid.Row="0" Margin="16" Spacing="10">
            <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                <Label
                    FontFamily="TechFont"
                    FontSize="12"
                    Text="// PROJECTS"
                    TextColor="{StaticResource TextSecondary}" />
                <Button
                    x:Name="ProjectSearchToggleButton"
                    Grid.Column="1"
                    BackgroundColor="Transparent"
                    BorderColor="{StaticResource BorderColor}"
                    BorderWidth="1"
                    Clicked="OnProjectToggleSearchPanelClicked"
                    CornerRadius="18"
                    FontFamily="HeaderFont"
                    FontSize="12"
                    HeightRequest="36"
                    Padding="16,0"
                    Text="SEARCH"
                    TextColor="{StaticResource TextSecondary}" />
            </Grid>

            <Border
                x:Name="ProjectSearchPanel"
                Padding="12"
                IsVisible="False"
                BackgroundColor="{StaticResource SurfaceDark}"
                Stroke="{StaticResource BorderColor}"
                StrokeShape="RoundRectangle 6"
                StrokeThickness="1">
                <VerticalStackLayout Spacing="12">
                    <SearchBar
                        x:Name="ProjectSearchBar"
                        BackgroundColor="Transparent"
                        FontFamily="TechFont"
                        Placeholder="Type project keywords..."
                        PlaceholderColor="{StaticResource TextSecondary}"
                        TextChanged="OnProjectSearchTextChanged"
                        TextColor="{StaticResource TextPrimary}" />

                    <VerticalStackLayout Spacing="4">
                        <Label
                            FontFamily="TechFont"
                            FontSize="11"
                            Text="SORT"
                            TextColor="{StaticResource TextSecondary}" />
                        <Picker
                            x:Name="ProjectSortPicker"
                            FontFamily="TechFont"
                            SelectedIndexChanged="OnProjectSortChanged"
                            TextColor="{StaticResource TextPrimary}">
                            <Picker.Items>
                                <x:String>NAME A-&gt;Z</x:String>
                                <x:String>NAME Z-&gt;A</x:String>
                                <x:String>CATEGORY A-&gt;Z</x:String>
                                <x:String>CATEGORY Z-&gt;A</x:String>
                                <x:String>PROGRESS HIGH-&gt;LOW</x:String>
                                <x:String>PROGRESS LOW-&gt;HIGH</x:String>
                            </Picker.Items>
                        </Picker>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>
        </VerticalStackLayout>

        <CollectionView
            x:Name="ProjectsList"
            Grid.Row="1"
            Margin="16,0,16,16"
            ItemsSource="{Binding Projects}"
            SelectionChanged="ProjectsList_SelectionChanged"
            SelectionMode="Single">

            <CollectionView.EmptyView>
                <VerticalStackLayout
                    HorizontalOptions="Center"
                    Spacing="10"
                    VerticalOptions="Center">
                    <Label
                        FontFamily="TechFont"
                        FontSize="12"
                        HorizontalOptions="Center"
                        Text="// SYSTEM MESSAGE"
                        TextColor="{StaticResource TextSecondary}" />

                    <Label
                        FontFamily="HeaderFont"
                        FontSize="24"
                        HorizontalOptions="Center"
                        Text="NO ACTIVE PROJECTS"
                        TextColor="{StaticResource TextPrimary}" />

                    <Label
                        FontFamily="TechFont"
                        HorizontalOptions="Center"
                        Text="Initialize new workflow to begin."
                        TextColor="{StaticResource TextSecondary}" />

                    <Button
                        Margin="0,20,0,0"
                        BackgroundColor="Transparent"
                        BorderColor="{StaticResource NeonAccent}"
                        BorderWidth="1"
                        Clicked="AddProjectBtn_Clicked"
                        FontFamily="HeaderFont"
                        Text="INITIALIZE PROJECT [+]"
                        TextColor="{StaticResource NeonAccent}"
                        WidthRequest="220" />
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border
                        Margin="0,0,0,12"
                        Padding="0"
                        BackgroundColor="{StaticResource SurfaceDark}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeShape="RoundRectangle 8"
                        StrokeThickness="1">

                        <Grid ColumnDefinitions="6, *" RowDefinitions="Auto, Auto, Auto">

                            <BoxView
                                Grid.RowSpan="3"
                                Grid.Column="0"
                                Color="{StaticResource NeonAccent}" />

                            <VerticalStackLayout
                                Grid.Column="1"
                                Padding="16,12"
                                Spacing="6">

                                <Grid ColumnDefinitions="*, Auto">
                                    <Label
                                        Grid.Column="0"
                                        FontAttributes="Bold"
                                        FontFamily="HeaderFont"
                                        FontSize="18"
                                        Text="{Binding Name}"
                                        TextColor="{StaticResource TextPrimary}"
                                        TextTransform="Uppercase" />

                                    <Label
                                        Grid.Column="1"
                                        FontSize="18"
                                        Text="&gt;"
                                        TextColor="{StaticResource TextSecondary}" />
                                </Grid>

                                <Label
                                    FontFamily="TechFont"
                                    FontSize="13"
                                    MaxLines="2"
                                    Text="{Binding Description, Converter={StaticResource TruncateConv}, ConverterParameter='50'}"
                                    TextColor="{StaticResource TextSecondary}" />

                                <Grid Margin="0,8,0,0" ColumnDefinitions="*, Auto">
                                    <ProgressBar
                                        Grid.Column="0"
                                        BackgroundColor="{StaticResource BorderColor}"
                                        Progress="{Binding Progress}"
                                        ProgressColor="{StaticResource NeonAccent}"
                                        ScaleY="2"
                                        VerticalOptions="Center">
                                        <ProgressBar.Triggers>
                                            <DataTrigger
                                                Binding="{Binding Progress}"
                                                TargetType="ProgressBar"
                                                Value="0">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </ProgressBar.Triggers>
                                    </ProgressBar>

                                    <Label
                                        Grid.Column="1"
                                        Margin="10,0,0,0"
                                        FontFamily="TechFont"
                                        FontSize="12"
                                        Text="{Binding Progress, StringFormat='{0:P0}'}"
                                        TextColor="{StaticResource NeonAccent}"
                                        VerticalOptions="Center">
                                        <Label.Triggers>
                                            <DataTrigger
                                                Binding="{Binding Progress}"
                                                TargetType="Label"
                                                Value="0">
                                                <Setter Property="IsVisible" Value="False" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                </Grid>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Button
            x:Name="AddProjectBtn"
            Grid.Row="2"
            Margin="20"
            Padding="0"
            BackgroundColor="{StaticResource NeonAccent}"
            Clicked="AddProjectBtn_Clicked"
            CornerRadius="16"
            FontFamily="HeaderFont"
            FontSize="32"
            HeightRequest="64"
            HorizontalOptions="End"
            Shadow="{StaticResource Shadow}"
            Text="+"
            TextColor="{StaticResource Black}"
            VerticalOptions="End"
            WidthRequest="64" />
    </Grid>
</ContentPage>