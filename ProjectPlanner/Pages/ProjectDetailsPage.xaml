<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ProjectPlanner.Pages.ProjectPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:ProjectPlanner.helpers"
    Title="PROJECT DETAILS"
    BackgroundColor="{StaticResource BackgroundDark}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:TextTruncateConverter x:Key="TruncateConv" />
            <converters:BoolToIconConverter x:Key="BoolToIconConverter" />
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid RowDefinitions="*, Auto">
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="20" Spacing="24">

                <Grid ColumnDefinitions="*, Auto, Auto" ColumnSpacing="12">

                    <Label
                        x:Name="NameLabel"
                        Grid.Column="0"
                        FontAttributes="Bold"
                        FontFamily="HeaderFont"
                        FontSize="22"
                        LineBreakMode="TailTruncation"
                        Text="PROJECT NAME"
                        TextColor="{StaticResource NeonAccent}"
                        TextTransform="Uppercase"
                        VerticalOptions="Center" />

                    <Button
                        x:Name="EditBtn"
                        Grid.Column="1"
                        BackgroundColor="Transparent"
                        BorderColor="{StaticResource TextSecondary}"
                        BorderWidth="1"
                        Clicked="EditBtn_Clicked"
                        CornerRadius="8"
                        FontFamily="HeaderFont"
                        FontSize="18"
                        HeightRequest="50"
                        Text="✎"
                        TextColor="{StaticResource TextPrimary}"
                        WidthRequest="50" />

                    <Button
                        x:Name="DelProjectBtn"
                        Grid.Column="2"
                        BackgroundColor="Transparent"
                        BorderColor="{StaticResource Magenta}"
                        BorderWidth="1"
                        Clicked="DelProjectBtn_Clicked"
                        CornerRadius="8"
                        FontFamily="HeaderFont"
                        FontSize="18"
                        HeightRequest="50"
                        Text="✕"
                        TextColor="{StaticResource Magenta}"
                        WidthRequest="50" />
                </Grid>

                <Border
                    Padding="16"
                    BackgroundColor="{StaticResource SurfaceDark}"
                    Stroke="{StaticResource BorderColor}"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <VerticalStackLayout Spacing="16">

                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontFamily="TechFont"
                                FontSize="12"
                                Text="CATEGORY"
                                TextColor="{StaticResource NeonAccent}" />
                            <Label
                                x:Name="TypeLabel"
                                FontFamily="TechFont"
                                FontSize="16"
                                Text="DIY / Woodworking"
                                TextColor="{StaticResource TextPrimary}" />
                        </VerticalStackLayout>

                        <BoxView HeightRequest="1" Color="{StaticResource BorderColor}" />

                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontFamily="TechFont"
                                FontSize="12"
                                Text="SPECIFICATION"
                                TextColor="{StaticResource NeonAccent}" />
                            <Label
                                x:Name="DescriptionLabel"
                                FontFamily="TechFont"
                                FontSize="14"
                                LineHeight="1.2"
                                Text="..."
                                TextColor="{StaticResource TextSecondary}" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <VerticalStackLayout Spacing="12">
                    <Label
                        FontFamily="TechFont"
                        FontSize="12"
                        Text="// TASKS LOG"
                        TextColor="{StaticResource TextSecondary}" />

                    <CollectionView
                        x:Name="TasksList"
                        SelectionChanged="OnCollectionViewSelectionChanged"
                        SelectionMode="Single">

                        <CollectionView.EmptyView>
                            <Border
                                Padding="20"
                                BackgroundColor="Transparent"
                                HorizontalOptions="Fill"
                                Stroke="{StaticResource BorderColor}"
                                StrokeDashArray="4,2"
                                StrokeThickness="1">
                                <Label
                                    FontFamily="TechFont"
                                    FontSize="12"
                                    HorizontalOptions="Center"
                                    Text="NO TASKS. INITIALIZE NEW TASK."
                                    TextColor="{StaticResource TextSecondary}" />
                            </Border>
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,0,0,8"
                                    Padding="12"
                                    BackgroundColor="{StaticResource SurfaceDark}"
                                    Stroke="{StaticResource BorderColor}"
                                    StrokeShape="RoundRectangle 4"
                                    StrokeThickness="1">
                                    <Grid ColumnDefinitions="Auto, *, Auto" ColumnSpacing="12">

                                        <Label
                                            Grid.Column="0"
                                            FontSize="20"
                                            Text="{Binding IsDone, Converter={StaticResource BoolToIconConverter}}"
                                            TextColor="{Binding IsDone, Converter={StaticResource BoolToColorConverter}}"
                                            VerticalOptions="Center" />

                                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                            <Label
                                                FontFamily="TechFont"
                                                FontSize="15"
                                                LineBreakMode="TailTruncation"
                                                Text="{Binding Name}"
                                                TextColor="{StaticResource TextPrimary}" />
                                        </VerticalStackLayout>

                                        <Label
                                            Grid.Column="2"
                                            FontSize="24"
                                            Text="›"
                                            TextColor="{StaticResource TextSecondary}"
                                            VerticalOptions="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

                <BoxView HeightRequest="80" Color="Transparent" />
            </VerticalStackLayout>
        </ScrollView>

        <Button
            x:Name="AddTaskBtn"
            Grid.Row="1"
            Margin="20"
            BackgroundColor="{StaticResource NeonAccent}"
            Clicked="AddTaskBtn_Clicked"
            CornerRadius="8"
            FontAttributes="Bold"
            FontFamily="HeaderFont"
            FontSize="16"
            HeightRequest="56"
            Shadow="{StaticResource Shadow}"
            Text="+ ADD NEW TASK"
            TextColor="{StaticResource Black}" />
    </Grid>
</ContentPage>