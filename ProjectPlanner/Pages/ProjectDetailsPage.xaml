<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ProjectPlanner.Pages.ProjectPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:converters="clr-namespace:ProjectPlanner.helpers"
    Title="PROJECT DETAILS"
    BackgroundColor="{StaticResource BackgroundDark}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <converters:TextTruncateConverter x:Key="TruncateConv" />
            <converters:BoolToIconConverter x:Key="BoolToIconConverter" />
            <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
            <converters:TaskStatusBadgeConverter x:Key="TaskStatusBadgeConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="*,Auto">
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="20" Spacing="24">

                <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12">
                    <Label
                        x:Name="NameLabel"
                        Grid.Column="0"
                        FontAttributes="Bold"
                        FontFamily="HeaderFont"
                        FontSize="22"
                        LineBreakMode="TailTruncation"
                        Text="PROJECT NAME"
                        TextColor="{StaticResource NeonAccent}"
                        TextTransform="Uppercase"
                        VerticalOptions="Center" />

                    <Button
                        x:Name="EditBtn"
                        Grid.Column="1"
                        BackgroundColor="Transparent"
                        BorderColor="{StaticResource TextSecondary}"
                        BorderWidth="1"
                        Clicked="EditBtn_Clicked"
                        CornerRadius="8"
                        FontFamily="HeaderFont"
                        FontSize="16"
                        HeightRequest="50"
                        Text="EDIT"
                        TextColor="{StaticResource TextPrimary}"
                        WidthRequest="70" />

                    <Button
                        x:Name="DelProjectBtn"
                        Grid.Column="2"
                        BackgroundColor="Transparent"
                        BorderColor="{StaticResource Magenta}"
                        BorderWidth="1"
                        Clicked="DelProjectBtn_Clicked"
                        CornerRadius="8"
                        FontFamily="HeaderFont"
                        FontSize="16"
                        HeightRequest="50"
                        Text="DEL"
                        TextColor="{StaticResource Magenta}"
                        WidthRequest="70" />
                </Grid>

                <Border
                    Padding="20"
                    BackgroundColor="{StaticResource SurfaceDark}"
                    Stroke="{StaticResource BorderColor}"
                    StrokeShape="RoundRectangle 8"
                    StrokeThickness="1">
                    <Grid>
                        <VerticalStackLayout x:Name="view_mode_content" Spacing="16">
                            <VerticalStackLayout Spacing="4">
                                <Label
                                    FontFamily="TechFont"
                                    FontSize="12"
                                    Text="CATEGORY"
                                    TextColor="{StaticResource TextSecondary}" />
                                <Label
                                    x:Name="TypeLabel"
                                    FontFamily="TechFont"
                                    FontSize="18"
                                    Text="NO TYPE"
                                    TextColor="{StaticResource TextPrimary}" />
                            </VerticalStackLayout>

                            <BoxView HeightRequest="1" Color="{StaticResource BorderColor}" />

                            <VerticalStackLayout Spacing="4">
                                <Label
                                    FontFamily="TechFont"
                                    FontSize="12"
                                    Text="SPECIFICATION"
                                    TextColor="{StaticResource TextSecondary}" />
                                <Label
                                    x:Name="DescriptionLabel"
                                    FontFamily="TechFont"
                                    FontSize="14"
                                    LineHeight="1.2"
                                    Text="NO DATA"
                                    TextColor="{StaticResource TextSecondary}" />
                            </VerticalStackLayout>
                        </VerticalStackLayout>

                        <VerticalStackLayout
                            x:Name="edit_mode_content"
                            IsVisible="False"
                            Spacing="16">
                            <VerticalStackLayout Spacing="8">
                                <Label
                                    FontAttributes="Bold"
                                    FontFamily="HeaderFont"
                                    FontSize="14"
                                    Text="PROJECT NAME"
                                    TextColor="{StaticResource NeonAccent}" />
                                <Border
                                    BackgroundColor="{StaticResource BackgroundDark}"
                                    Stroke="{StaticResource BorderColor}"
                                    StrokeShape="RoundRectangle 4"
                                    StrokeThickness="1">
                                    <Entry
                                        x:Name="entry_project_name"
                                        Margin="12"
                                        FontFamily="TechFont"
                                        FontSize="16"
                                        Placeholder="ENTER NAME..."
                                        PlaceholderColor="{StaticResource TextSecondary}"
                                        TextColor="{StaticResource TextPrimary}" />
                                </Border>
                            </VerticalStackLayout>

                            <VerticalStackLayout Spacing="8">
                                <Label
                                    FontAttributes="Bold"
                                    FontFamily="HeaderFont"
                                    FontSize="14"
                                    Text="CATEGORY"
                                    TextColor="{StaticResource NeonAccent}" />
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                    <Border
                                        Grid.Column="0"
                                        BackgroundColor="{StaticResource BackgroundDark}"
                                        Stroke="{StaticResource BorderColor}"
                                        StrokeShape="RoundRectangle 4"
                                        StrokeThickness="1">
                                        <Picker
                                            x:Name="picker_type"
                                            Margin="12"
                                            FontFamily="TechFont"
                                            FontSize="16"
                                            TextColor="{StaticResource TextPrimary}" />
                                    </Border>
                                    <Button
                                        Grid.Column="1"
                                        Padding="12,0"
                                        BackgroundColor="Transparent"
                                        BorderColor="{StaticResource NeonAccent}"
                                        BorderWidth="1"
                                        Clicked="OnManageTypesClicked"
                                        CornerRadius="6"
                                        FontFamily="HeaderFont"
                                        FontSize="12"
                                        HeightRequest="48"
                                        Text="MANAGE"
                                        TextColor="{StaticResource NeonAccent}" />
                                </Grid>
                            </VerticalStackLayout>

                            <VerticalStackLayout Spacing="8">
                                <Label
                                    FontAttributes="Bold"
                                    FontFamily="HeaderFont"
                                    FontSize="14"
                                    Text="DESCRIPTION"
                                    TextColor="{StaticResource NeonAccent}" />
                                <Border
                                    BackgroundColor="{StaticResource BackgroundDark}"
                                    Stroke="{StaticResource BorderColor}"
                                    StrokeShape="RoundRectangle 4"
                                    StrokeThickness="1">
                                    <Editor
                                        x:Name="editor_description"
                                        Margin="12"
                                        AutoSize="TextChanges"
                                        FontFamily="TechFont"
                                        FontSize="14"
                                        Placeholder="MORE DATA..."
                                        PlaceholderColor="{StaticResource TextSecondary}"
                                        TextColor="{StaticResource TextPrimary}"
                                        VerticalOptions="Start" />
                                </Border>
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <VerticalStackLayout Spacing="12">
                    <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                        <Label
                            FontFamily="TechFont"
                            FontSize="12"
                            Text="// TASKS LOG"
                            TextColor="{StaticResource TextSecondary}" />
                        <Button
                            x:Name="search_toggle_button"
                            Grid.Column="1"
                            BackgroundColor="Transparent"
                            BorderColor="{StaticResource BorderColor}"
                            BorderWidth="1"
                            Clicked="OnToggleSearchPanelClicked"
                            CornerRadius="18"
                            FontFamily="HeaderFont"
                            FontSize="12"
                            HeightRequest="36"
                            Padding="16,0"
                            Text="SEARCH"
                            TextColor="{StaticResource TextSecondary}" />
                    </Grid>

                    <Border
                        x:Name="task_filters_panel"
                        Padding="12"
                        IsVisible="False"
                        BackgroundColor="{StaticResource SurfaceDark}"
                        Stroke="{StaticResource BorderColor}"
                        StrokeShape="RoundRectangle 6"
                        StrokeThickness="1">
                        <FlexLayout
                            Direction="Row"
                            Wrap="Wrap"
                            AlignItems="Start"
                            AlignContent="Start"
                            JustifyContent="SpaceBetween">
                            <VerticalStackLayout FlexLayout.Basis="100%" Spacing="4" Margin="0,0,0,12">
                                 <Label
                                     FontFamily="TechFont"
                                     FontSize="11"
                                     Text="SEARCH"
                                     TextColor="{StaticResource TextSecondary}" />
                                 <SearchBar
                                     x:Name="task_search_bar"
                                     Margin="0"
                                     BackgroundColor="Transparent"
                                     FontFamily="TechFont"
                                     Placeholder="Type keywords..."
                                     PlaceholderColor="{StaticResource TextSecondary}"
                                     TextChanged="OnTaskSearchTextChanged"
                                     TextColor="{StaticResource TextPrimary}" />
                             </VerticalStackLayout>

                            <VerticalStackLayout Spacing="4"
                                 Margin="0,0,12,12"
                                  FlexLayout.Basis="Auto"
                                  WidthRequest="110">
                                 <Label
                                     FontFamily="TechFont"
                                     FontSize="11"
                                     HorizontalOptions="Center"
                                     Text="SEARCH BY"
                                     TextColor="{StaticResource TextSecondary}" />
                                 <Picker
                                     x:Name="SearchScopePicker"
                                     WidthRequest="110"
                                     FontFamily="TechFont"
                                     SelectedIndexChanged="OnSearchScopeChanged"
                                     TextColor="{StaticResource TextPrimary}">
                                     <Picker.Items>
                                         <x:String>NAME</x:String>
                                         <x:String>TAGS</x:String>
                                     </Picker.Items>
                                 </Picker>
                             </VerticalStackLayout>

                            <VerticalStackLayout Spacing="4"
                                Margin="0,0,12,0"
                                 FlexLayout.Basis="Auto"
                                 WidthRequest="150">
                                  <Label
                                      FontFamily="TechFont"
                                      FontSize="11"
                                      HorizontalOptions="Center"
                                     Text="SORT"
                                      TextColor="{StaticResource TextSecondary}" />
                                  <Picker
                                      x:Name="SortFieldPicker"
                                     WidthRequest="150"
                                      FontFamily="TechFont"
                                      SelectedIndexChanged="OnSortFieldChanged"
                                      TextColor="{StaticResource TextPrimary}">
                                      <Picker.Items>
                                         <x:String>PRIORITY DESC</x:String>
                                         <x:String>PRIORITY ASC</x:String>
                                         <x:String>ALPHABETICAL DESC</x:String>
                                         <x:String>ALPHABETICAL ASC</x:String>
                                     </Picker.Items>
                                 </Picker>
                             </VerticalStackLayout>
                        </FlexLayout>
                     </Border>

                    <HorizontalStackLayout Spacing="8" VerticalOptions="Center">
                        <CheckBox
                            x:Name="chk_hide_done"
                            CheckedChanged="OnHideDoneChanged"
                            Color="{StaticResource NeonAccent}" />
                        <Label
                            FontFamily="TechFont"
                            FontSize="12"
                            Text="HIDE COMPLETED"
                            TextColor="{StaticResource TextSecondary}"
                            VerticalOptions="Center" />
                    </HorizontalStackLayout>

                    <CollectionView
                        x:Name="TasksList"
                        SelectionChanged="OnCollectionViewSelectionChanged"
                        SelectionMode="Single">

                        <CollectionView.EmptyView>
                            <Border
                                Padding="20"
                                BackgroundColor="Transparent"
                                HorizontalOptions="Fill"
                                Stroke="{StaticResource BorderColor}"
                                StrokeDashArray="4,2"
                                StrokeThickness="1">
                                <Label
                                    FontFamily="TechFont"
                                    FontSize="12"
                                    HorizontalOptions="Center"
                                    Text="NO TASKS. INITIALIZE NEW TASK."
                                    TextColor="{StaticResource TextSecondary}" />
                            </Border>
                        </CollectionView.EmptyView>

                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Border
                                    Margin="0,0,0,8"
                                    Padding="12"
                                    BackgroundColor="{StaticResource SurfaceDark}"
                                    Stroke="{StaticResource BorderColor}"
                                    StrokeShape="RoundRectangle 4"
                                    StrokeThickness="1">
                                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                        <Label
                                            Grid.Column="0"
                                            FontSize="20"
                                            Text="{Binding ., Converter={StaticResource TaskStatusBadgeConverter}}"
                                            TextColor="{Binding IsDone, Converter={StaticResource BoolToColorConverter}}"
                                            VerticalOptions="Center" />
                                        <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                            <Label
                                                FontFamily="TechFont"
                                                FontSize="15"
                                                LineBreakMode="TailTruncation"
                                                Text="{Binding Name}"
                                                TextColor="{StaticResource TextPrimary}" />
                                        </VerticalStackLayout>
                                        <Label
                                            Grid.Column="2"
                                            FontSize="20"
                                            Text="&gt;"
                                            TextColor="{StaticResource TextSecondary}"
                                            VerticalOptions="Center" />
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </VerticalStackLayout>
        </ScrollView>

        <Button
            x:Name="AddTaskBtn"
            Grid.Row="1"
            Margin="20"
            BackgroundColor="{StaticResource NeonAccent}"
            Clicked="AddTaskBtn_Clicked"
            CornerRadius="8"
            FontAttributes="Bold"
            FontFamily="HeaderFont"
            FontSize="16"
            HeightRequest="56"
            Text="+ ADD NEW TASK"
            TextColor="{StaticResource Black}" />

        <Grid
            x:Name="edit_buttons_grid"
            Grid.Row="1"
            Padding="20"
            ColumnDefinitions="*,Auto"
            ColumnSpacing="16"
            IsVisible="False">
            <Button
                x:Name="btn_save_project"
                Grid.Column="0"
                BackgroundColor="{StaticResource NeonAccent}"
                Clicked="OnSaveClicked"
                CornerRadius="8"
                FontAttributes="Bold"
                FontFamily="HeaderFont"
                HeightRequest="56"
                Text="SAVE"
                TextColor="{StaticResource Black}" />
            <Button
                x:Name="btn_cancel_project"
                Grid.Column="1"
                BackgroundColor="Transparent"
                BorderColor="{StaticResource NeonAccent}"
                BorderWidth="1"
                Clicked="EditBtn_Clicked"
                CornerRadius="8"
                FontFamily="HeaderFont"
                FontSize="16"
                HeightRequest="56"
                Text="CANCEL"
                TextColor="{StaticResource NeonAccent}"
                WidthRequest="120" />
        </Grid>
    </Grid>
</ContentPage>